import Foundation
import Numerics

public func allClose<T: Numeric>(
    _ lhs: [T],
    _ rhs: [T],
    absoluteTolerance: T.Magnitude = T.Magnitude.ulpOfOne.squareRoot()
        * T.Magnitude.leastNormalMagnitude,
    relativeTolerance: T.Magnitude = T.Magnitude.ulpOfOne.squareRoot()
) -> Bool where T.Magnitude: FloatingPoint {
    guard lhs.count == rhs.count else {
        return false
    }
    for (l, r) in zip(lhs, rhs) {
        guard
            l.isApproximatelyEqual(
                to: r,
                absoluteTolerance: absoluteTolerance,
                relativeTolerance: relativeTolerance
            )
        else {
            return false
        }
    }
    return true
}

public func testData(named name: String, withExtension ext: String) -> Data? {
    guard
        let url = Bundle.module.url(
            forResource: name,
            withExtension: ext,
            subdirectory: "Data"
        )
    else {
        return nil
    }
    return try? Data(contentsOf: url)
}

public let quantizedValuesByName: [(name: String, values: [Float])] = [
    (
        name: "Q2_K",
        values: [
            -0.00409698486328125,
            -0.00409698486328125,
            -0.021081924438476562,
            0.029872894287109375,
            -0.00409698486328125,
            0.012887954711914062,
            -0.00409698486328125,
            -0.00409698486328125,
            -0.00409698486328125,
            -0.021081924438476562,
            -0.00409698486328125,
            -0.00409698486328125,
            0.012887954711914062,
            -0.00409698486328125,
            -0.00409698486328125,
            -0.00409698486328125,
            0.019454002380371094,
            0.0024690628051757812,
            0.0024690628051757812,
            0.010961532592773438,
            -0.006023406982421875,
            -0.006023406982421875,
            0.0024690628051757812,
            0.019454002380371094,
            0.0024690628051757812,
            0.0024690628051757812,
            0.0024690628051757812,
            0.0024690628051757812,
            0.0024690628051757812,
            0.0024690628051757812,
            0.0024690628051757812,
            -0.006023406982421875,
        ]
    ),
    (
        name: "Q3_K",
        values: [
            -0.0,
            -0.0,
            -0.01607227325439453,
            0.03214454650878906,
            -0.008036136627197266,
            0.008036136627197266,
            -0.0,
            -0.008036136627197266,
            -0.0,
            -0.01607227325439453,
            -0.0,
            -0.0,
            0.008036136627197266,
            -0.008036136627197266,
            -0.0,
            -0.0,
            0.021993637084960938,
            -0.0,
            0.005498409271240234,
            0.010996818542480469,
            -0.005498409271240234,
            -0.005498409271240234,
            -0.0,
            0.016495227813720703,
            -0.0,
            0.005498409271240234,
            -0.0,
            -0.0,
            0.005498409271240234,
            -0.0,
            -0.0,
            -0.0,
        ]
    ),
    (
        name: "Q4_0",
        values: [
            -0.003997802734375,
            0.003997802734375,
            -0.019989013671875,
            0.031982421875,
            -0.003997802734375,
            0.00799560546875,
            -0.0,
            -0.003997802734375,
            -0.0,
            -0.0159912109375,
            0.003997802734375,
            0.003997802734375,
            0.011993408203125,
            -0.00799560546875,
            -0.0,
            0.003997802734375,
            0.02398681640625,
            -0.0,
            0.003997802734375,
            0.011993408203125,
            -0.00799560546875,
            -0.003997802734375,
            -0.0,
            0.0159912109375,
            -0.0,
            0.003997802734375,
            -0.0,
            -0.0,
            0.003997802734375,
            -0.0,
            -0.0,
            -0.003997802734375,
        ]
    ),
    (
        name: "Q4_K",
        values: [
            -0.0019982457160949707,
            0.001438736915588379,
            -0.01918315887451172,
            0.032371580600738525,
            -0.00543522834777832,
            0.008312702178955078,
            0.001438736915588379,
            -0.00543522834777832,
            0.001438736915588379,
            -0.01574617624282837,
            0.0048757195472717285,
            0.0048757195472717285,
            0.011749684810638428,
            -0.00887221097946167,
            0.001438736915588379,
            0.0048757195472717285,
            0.022060632705688477,
            0.001438736915588379,
            0.0048757195472717285,
            0.011749684810638428,
            -0.00887221097946167,
            -0.00543522834777832,
            0.001438736915588379,
            0.015186667442321777,
            0.001438736915588379,
            0.0048757195472717285,
            0.001438736915588379,
            -0.0019982457160949707,
            0.0048757195472717285,
            0.001438736915588379,
            -0.0019982457160949707,
            -0.0019982457160949707,
        ]
    ),
    (
        name: "Q5_0",
        values: [
            -0.003997802734375,
            0.003997802734375,
            -0.019989013671875,
            0.031982421875,
            -0.0059967041015625,
            0.0099945068359375,
            -0.0,
            -0.0059967041015625,
            0.0019989013671875,
            -0.0159912109375,
            0.003997802734375,
            0.003997802734375,
            0.0099945068359375,
            -0.0099945068359375,
            -0.0,
            0.003997802734375,
            0.0219879150390625,
            -0.0,
            0.0059967041015625,
            0.0139923095703125,
            -0.00799560546875,
            -0.0059967041015625,
            -0.0,
            0.0159912109375,
            -0.0,
            0.003997802734375,
            0.0019989013671875,
            -0.0019989013671875,
            0.0059967041015625,
            0.0019989013671875,
            -0.0,
            -0.0019989013671875,
        ]
    ),
    (
        name: "Q5_K",
        values: [
            -0.0032927989959716797,
            0.0034863948822021484,
            -0.02024078369140625,
            0.03229796886444092,
            -0.004987597465515137,
            0.010265588760375977,
            9.679794311523438e-05,
            -0.004987597465515137,
            0.0017915964126586914,
            -0.015156388282775879,
            0.0034863948822021484,
            0.0034863948822021484,
            0.010265588760375977,
            -0.010071992874145508,
            9.679794311523438e-05,
            0.0034863948822021484,
            0.022129178047180176,
            9.679794311523438e-05,
            0.0051811933517456055,
            0.01365518569946289,
            -0.00837719440460205,
            -0.004987597465515137,
            9.679794311523438e-05,
            0.015349984169006348,
            9.679794311523438e-05,
            0.0051811933517456055,
            0.0017915964126586914,
            -0.0015980005264282227,
            0.0051811933517456055,
            0.0017915964126586914,
            -0.0015980005264282227,
            -0.0032927989959716797,
        ]
    ),
    (
        name: "Q6_K",
        values: [
            -0.003096342086791992,
            0.003096342086791992,
            -0.019610166549682617,
            0.031995534896850586,
            -0.00516057014465332,
            0.01032114028930664,
            -0.0,
            -0.00516057014465332,
            0.002064228057861328,
            -0.015481710433959961,
            0.003096342086791992,
            0.004128456115722656,
            0.01032114028930664,
            -0.009289026260375977,
            0.001032114028930664,
            0.003096342086791992,
            0.022150754928588867,
            0.0007145404815673828,
            0.0057163238525390625,
            0.013576269149780273,
            -0.008574485778808594,
            -0.0057163238525390625,
            -0.0,
            0.015719890594482422,
            -0.0,
            0.00500178337097168,
            0.0014290809631347656,
            -0.0014290809631347656,
            0.0057163238525390625,
            0.0014290809631347656,
            -0.0007145404815673828,
            -0.0028581619262695312,
        ]
    ),
    (
        name: "Q8_0",
        values: [
            -0.003021240234375,
            0.003021240234375,
            -0.0196380615234375,
            0.03197479248046875,
            -0.005035400390625,
            0.01007080078125,
            0.0,
            -0.005035400390625,
            0.0015106201171875,
            -0.015106201171875,
            0.0035247802734375,
            0.00377655029296875,
            0.0105743408203125,
            -0.0095672607421875,
            0.0005035400390625,
            0.0035247802734375,
            0.02215576171875,
            0.0005035400390625,
            0.0055389404296875,
            0.01334381103515625,
            -0.00830841064453125,
            -0.0055389404296875,
            -0.00025177001953125,
            0.0156097412109375,
            -0.00025177001953125,
            0.005035400390625,
            0.00176239013671875,
            -0.00176239013671875,
            0.0055389404296875,
            0.00125885009765625,
            -0.001007080078125,
            -0.00276947021484375,
        ]
    ),
]
